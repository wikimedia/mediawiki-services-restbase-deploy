"use strict";

var async = require('async');
var cass = require('node-cassandra-cql');

var client = new cass.Client({hosts: ['localhost'], keyspace: 'test'});
var defaultConsistency = cass.types.consistencies.one;
var reconnectCB = function(err) {
    if (err) {
        // keep trying each 500ms
        console.error('Cassandra connection error @ localhost :', err, '\nretrying..');
        setTimeout(client.connect.bind(client, reconnectCB), 500);
    }
};
client.on('connection', reconnectCB);
client.connect();
var i = 0;

async.whilst(
        function () { return i < 9000000; },
        function (cb) {
            i++;
            if (! (i % 10000)) {
                console.log(i);
            }
            client.executeAsPrepared("insert into index_test (a, b, c, d) values (?, ?, ?, ?)",
            ['foo', 'foobar', i.toString(), 'bar'], defaultConsistency, cb);
        },
        function(err) {
            if (err) {
                console.error(err);
            }
            client.close();
        }
);
