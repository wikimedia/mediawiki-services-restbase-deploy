!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.tassembly=t()}}(function(){return function g(n,s,e){function l(a,b){if(!s[a]){if(!n[a]){var d="function"==typeof require&&require;if(!b&&d)return d(a,!0);if(q)return q(a,!0);throw Error("Cannot find module '"+a+"'");}d=s[a]={exports:{}};
n[a][0].call(d.exports,function(c){var b=n[a][1][c];return l(b?b:c)},d,d.exports,g,n,s,e)}return s[a].exports}for(var q="function"==typeof require&&require,r=0;r<e.length;r++)l(e[r]);return l}({1:[function(g,n,s){function e(a){this.protocolRegex=l}var l=RegExp("^(http://|https://|ftp://|irc://|ircs://|gopher://|telnet://|nntp://|worldwind://|mailto:|news:|svn://|git://|mms://|//)","i"),q=/&([A-Za-z0-9\x80-\xff]+);|&\#([0-9]+);|&\#[xX]([0-9A-Fa-f]+);|(&)/;e.prototype.decodeCharReferences=function(a){var b=
this;return a.replace(q,function(a,c,h,m,k){return c?b.decodeEntity(c):h?b.decodeChar(parseInt(h,10)):m?b.decodeChar(parseInt(m,16)):k})};var r=RegExp("[\t ]|\u00ad|\u1806|\u200b|\u2060|\ufeff|\u034f|\u180b|\u180c|\u180d|\u200c|\u200d|[\ufe00-\ufe0f]","g");e.prototype.cssDecodeRE=/\\(?:((?:\n|\r\n|\r|\f))|([0-9A-Fa-f]{1,6})[\x20\t\r\n\f]?|(.)|()$)/;e.prototype.sanitizeStyle=function(a){function b(a,b){var d,k;"'"===b?(d=/'/g,k=/'([^'\n\r\f]*)$/):(d=/"/g,k=/"([^"\n\r\f]*)$/);if(1===(a.match(d)||[]).length%
2)a=a.replace(k,function(a,c){return" "+c});return a}a=this.decodeCharReferences(a);a=a.replace(this.cssDecodeRE,function(a,b,d,k){var f;if(void 0!==b)return"";if(void 0!==d){a=parseInt(d,16);try{f=String.fromCharCode(a)}catch(e){f=a.toString()}}else f=void 0!==k?k:"\\";return"\n"===f||'"'===f||"'"===f||"\\"===f?"\\"+f.charCodeAt(0).toString(16)+" ":f});a=a.replace(/\/\*.*\*\//g," ");a=b(a,"'");a=b(a,'"');var d=a.indexOf("/*");0<=d&&(a=a.substr(0,d));return/[\000-\010\016-\037\177]/.test(a)?"/* invalid control char */":
/expression|filter\s*:|accelerator\s*:|url\s*\(/i.test(a)?"/* insecure input */":a};e.prototype.sanitizeHref=function(a){var b=a.match(/^((?:[a-zA-Z][^:\/]*:)?(?:\/\/)?)([^\/]+)(\/?.*)/),d,c;if(b){if(d=b[1],c=b[2],a=b[3],!d.match(this.protocolRegex))return null}else c=d="";c=c.replace(r,"");return d+c+a};n.exports={AttributeSanitizer:e}},{}],2:[function(g,n,s){function e(){this.uid=0;this.cache={};this.partials={}}function l(a){var b="",d=-1,c="";do{if(/^$|[\[:(,]/.test(c))b+=c,/[pri]/.test(a[d+1])&&
/(?:p(?:[cm]s?)?|r[mc]|i)(?:[\.\)\]}]|$)/.test(a.slice(d+1))&&(b+="c.");else if("'"===c){if(c=a.slice(d).match(/'(?:[^\\']+|\\')*'/))b+=c[0],d+=c[0].length-1}else b+=c;d++;c=a[d]}while(c);return b}function q(a,b){a=""+a;var d;if(r.test(a))return d=l(a);if(/^'/.test(a))return JSON.stringify(a.slice(1,-1).replace(/\\'/g,"'"));if(/^[cm](?:\.[a-zA-Z_$]*)?$/.test(a))return a;var c;d=l(a);c=b&&b.errorHandler?"return c.options.errorHandler(e);":'console.error("Error in " + '+JSON.stringify(d)+'+": " + e.toString()); return ""';
return"(function() { try {return "+d+";} catch (e) { "+c+" }})()"}g=new (g("./AttributeSanitizer.js").AttributeSanitizer);e.prototype.attrSanitizer=g;e.prototype._getUID=function(){this.uid++;return this.uid};var r=/^(m|p(?:[cm]s?)?|r[mc]|i|c)\.([a-zA-Z_$]+)$/;e.prototype._evalExpr=function(a,b){var d=this.cache["expr"+a];if(!d){if(d=a.match(r))return b[d[1]][d[2]];if(/^'.*'$/.test(a))return a.slice(1,-1).replace(/\\'/g,"'");d=new Function("c","var m = c.m;return "+l(a));this.cache["expr"+a]=d}if(d)try{return d(b)}catch(c){return console.error("Error while evaluating "+
a),console.error(c),""}return a};e.prototype._getTemplate=function(a,b){if(Array.isArray(a))return a;/^'/.test(a)&&(a=a.slice(1,-1).replace(/\\'/g,"'"));return b.rc.options.partials[a]};e.prototype.ctlFn_foreach=function(a,b){var d=this._evalExpr(a.data,b);if(d&&Array.isArray(d))for(var c=this.compile(this._getTemplate(a.tpl),b),h=d.length,m=this.childContext(null,b),k=0;k<h;k++)m.m=d[k],m.pms[0]=d[k],m.i=k,c(m)};e.prototype.ctlFn_template=function(a,b){var d=this._evalExpr(a.data,b),d=this.childContext(d,
b),c=this._getTemplate(a.tpl,b);c&&this._render(c,d)};e.prototype.ctlFn_with=function(a,b){var d=this._evalExpr(a.data,b),c=this._getTemplate(a.tpl,b);d&&c&&(d=this.childContext(d,b),this._render(c,d))};e.prototype.ctlFn_if=function(a,b){this._evalExpr(a.data,b)&&this._render(a.tpl,b)};e.prototype.ctlFn_ifnot=function(a,b){this._evalExpr(a.data,b)||this._render(a.tpl,b)};e.prototype.ctlFn_attr=function(a,b){var d=this,c;Object.keys(a).forEach(function(h){var m=a[h];"string"===typeof m?c=d._evalExpr(a[h],
b):(c=m.v||"",m.app&&Array.isArray(m.app)&&m.app.forEach(function(a){a["if"]&&d._evalExpr(a["if"],b)&&(c+=a.v||"");a.ifnot&&!d._evalExpr(a.ifnot,b)&&(c+=a.v||"")}),!c&&null===m.v&&(c=null));c&&("href"===h||"src"===h?c=this.attrSanitizer.sanitizeHref(c):"style"===h&&(c=this.attrSanitizer.sanitizeStyle(c)));(c||0===c||""===c)&&b.cb(" "+h+'="'+c.toString().replace(/"/g,"&quot;")+'"')})};e.prototype._xmlEncoder=function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case '"':return"&quot;";
default:return"&#"+a.charCodeAt()+";"}};e.prototype.childContext=function(a,b){return{m:a,pc:b,pm:b.m,pms:[a].concat(b.ps),rm:b.rm,rc:b.rc,cb:b.cb}};e.prototype._assemble=function(a,b){function d(a){h.length&&(c.push("cb("+h.join("+")+");"),h=[]);c.push(a)}var c=[],h=[];c.push("var val;");for(var m=a.length,e=0;e<m;e++){var f=a[e],p=f.constructor;if(p===String)h.push(JSON.stringify(f));else if(p===Array)if(p=f[0],f=f[1],"raw"===p)d("val = "+q(f,b)+";\n"),h.push("val");else if("text"===p)d("val = "+
q(f,b)+';\nval = val || val === 0 ? "" + val : "";\nif(/[<&]/.test(val)) { val = val.replace(/[<&]/g,this._xmlEncoder); }\n'),h.push("val");else if("attr"===p)for(var p=Object.keys(f),g=0;g<p.length;g++){var l=p[g];if("string"===typeof f[l])c.push("val = "+q(f[l],b)+";");else{var n=f[l];c.push("val="+JSON.stringify(n.v||""));n.app&&Array.isArray(n.app)&&n.app.forEach(function(a){a["if"]?(c.push("if("+q(a["if"],b)+"){"),c.push("val += "+JSON.stringify(a.v||"")+";"),c.push("}")):a.ifnot&&(c.push("if(!"+
q(a.ifnot,b)+"){"),c.push("val += "+JSON.stringify(a.v||"")),c.push("}"))});null===n.v&&c.push("if(!val) { val = null; }")}"href"===l||"src"===l?c.push("if (val) {val = this.attrSanitizer.sanitizeHref(val);}"):"style"===l&&c.push("if (val) {val = this.attrSanitizer.sanitizeStyle(val);}");d('if (val || val === 0 || val === \'\') { \nval = val || val === 0 ? "" + val : "";\nif(/[<&"]/.test(val)) { val = val.replace(/[<&"]/g,this._xmlEncoder); }\ncb('+JSON.stringify(" "+l+'="')+" + val + '\"');}")}else g=
this._getUID(),this.cache[g]=f,d("try {"),c.push("this["+JSON.stringify("ctlFn_"+p)+'](this.cache["'+g+'"], c);'),c.push("} catch(e) {"),c.push("console.error('Unsupported control function:', "+JSON.stringify(p)+", e.stack);"),c.push("}");else console.error("Unsupported type:",f)}d("");return c.join("\n")};e.prototype.render=function(a,b,d){d||(d={});b={rm:b,m:b,pms:[b],rc:null,g:d.globals,cb:d.cb,options:d};b.rc=b;var c="";d.cb||(b.cb=function(a){c+=a});this._render(a,b);if(!d.cb)return c};e.prototype._render=
function(a,b){if(a.__cachedFn)return a.__cachedFn(b);for(var d=a.length,c=b.cb,h=0;h<d;h++){var e=a[h],k=e.constructor;if(k===String)c(e);else if(k===Array){var k=e[0],f=e[1];if("raw"===k)c(this._evalExpr(f,b));else if("text"===k)e=this._evalExpr(f,b),!e&&0!==e&&(e=""),c((""+e).replace(/[<&]/g,this._xmlEncoder));else try{this["ctlFn_"+k](f,b)}catch(g){console.error("Unsupported control function:",e,g)}}else console.error("Unsupported type:",e)}};e.prototype.compile=function(a,b){var d=this,c=b||{};
if(a.__cachedFn)return a.__cachedFn;var e="";c.nestedTemplate?e+="var m = c.m, cb = c.cb;\n":(e=c.cb?e+"cb = options.cb;\n":e+'var res = "", cb = function(bit) { res += bit; };\n',e+="var m = c;\nc = { rc: null, rm: m, m: m, pms: [m], g: options.globals, options: options, cb: cb, nestedTemplate: true }; c.rc = c;\n");e+=this._assemble(a,c);c.cb||(e+="return res;");var g=new Function("c","options",e),e=function(a,b){return g.call(d,a,b||c)};return a.__cachedFn=e};n.exports=new e},{"./AttributeSanitizer.js":1}]},
{},[2])(2)});
