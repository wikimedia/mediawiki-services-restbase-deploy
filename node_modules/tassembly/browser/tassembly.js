(function(t){"object"===typeof exports&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).tassembly=t()})(function(){return function r(k,s,e){function l(a,b){if(!s[a]){if(!k[a]){var c="function"==typeof require&&require;if(!b&&c)return c(a,!0);if(q)return q(a,!0);c=Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c;}c=s[a]=
{exports:{}};k[a][0].call(c.exports,function(d){var b=k[a][1][d];return l(b?b:d)},c,c.exports,r,k,s,e)}return s[a].exports}for(var q="function"==typeof require&&require,n=0;n<e.length;n++)l(e[n]);return l}({1:[function(r,k,s){function e(a){this.protocolRegex=l}var l=RegExp("^(http://|https://|ftp://|irc://|ircs://|gopher://|telnet://|nntp://|worldwind://|mailto:|news:|svn://|git://|mms://|//)","i"),q=/&([A-Za-z0-9\x80-\xff]+);|&\#([0-9]+);|&\#[xX]([0-9A-Fa-f]+);|(&)/;e.prototype.decodeCharReferences=
function(a){var b=this;return a.replace(q,function(a,d,g,m,h){return d?b.decodeEntity(d):g?b.decodeChar(parseInt(g,10)):m?b.decodeChar(parseInt(m,16)):h})};var n=RegExp("[\t ]|\u00ad|\u1806|\u200b|\u2060|\ufeff|\u034f|\u180b|\u180c|\u180d|\u200c|\u200d|[\ufe00-\ufe0f]","g");e.prototype.cssDecodeRE=/\\(?:((?:\n|\r\n|\r|\f))|([0-9A-Fa-f]{1,6})[\x20\t\r\n\f]?|(.)|()$)/;e.prototype.sanitizeStyle=function(a){function b(a,b){var c,h;"'"===b?(c=/'/g,h=/'([^'\n\r\f]*)$/):(c=/"/g,h=/"([^"\n\r\f]*)$/);if(1===
(a.match(c)||[]).length%2)a=a.replace(h,function(a,b){return" "+b});return a}a=this.decodeCharReferences(a);a=a.replace(this.cssDecodeRE,function(a,b,c,h){var f;if(void 0!==b)return"";if(void 0!==c){a=parseInt(c,16);try{f=String.fromCharCode(a)}catch(e){f=a.toString()}}else f=void 0!==h?h:"\\";return"\n"===f||'"'===f||"'"===f||"\\"===f?"\\"+f.charCodeAt(0).toString(16)+" ":f});a=a.replace(/\/\*.*\*\//g," ");a=b(a,"'");a=b(a,'"');var c=a.indexOf("/*");0<=c&&(a=a.substr(0,c));return/[\000-\010\016-\037\177]/.test(a)?
"/* invalid control char */":/expression|filter\s*:|accelerator\s*:|url\s*\(/i.test(a)?"/* insecure input */":a};e.prototype.sanitizeHref=function(a){var b=a.match(/^((?:[a-zA-Z][^:\/]*:)?(?:\/\/)?)([^\/]+)(\/?.*)/),c,d;if(b){if(c=b[1],d=b[2],a=b[3],!c.match(this.protocolRegex))return null}else d=c="";d=d.replace(n,"");return c+d+a};k.exports={AttributeSanitizer:e}},{}],2:[function(r,k,s){function e(){this.uid=0;this.cache={};this.partials={}}function l(a){var b="",c=-1,d="";do{if(/^$|[\[:(,]/.test(d))b+=
d,/[pri]/.test(a[c+1])&&/^(?:p(?:[cm]s?)|r[mc]|i)(?:[\.\(\)}\[\]]|$)/.test(a.slice(c+1))&&(b+="c.");else if("'"===d){if(d=a.slice(c).match(/'(?:[^\\']+|\\')*'/))b+=d[0],c+=d[0].length-1}else b+=d;c++;d=a[c]}while(d);return b}function q(a,b,c){c=c||"";a=""+a;if(n.test(a))return a=l(a),c+a;if(/^'/.test(a))return c+JSON.stringify(a.slice(1,-1).replace(/\\'/g,"'"));if(/^[cm](?:\.[a-zA-Z_$]*)?$/.test(a))return c+a;a=l(a);b=b&&b.errorHandler?"c.options.errorHandler(e)":'(console.error("Error in " + '+JSON.stringify(a)+
'+": " + e.toString()) || "")';return c?"try {"+c+a+";} catch (e) {"+c+b+"; }":"(function() { try {return "+a+";} catch (e) { return "+b+"; }})()"}r=new (r("./AttributeSanitizer.js").AttributeSanitizer);e.prototype.attrSanitizer=r;e.prototype._getUID=function(){this.uid++;return this.uid};var n=/^(m|p(?:[cm]s?)?|r[mc]|i|c)\.([a-zA-Z_$]+)$/;e.prototype._evalExpr=function(a,b){var c=this.cache["expr"+a];if(!c){if(c=a.match(n))return b[c[1]][c[2]];if(/^'.*'$/.test(a))return a.slice(1,-1).replace(/\\'/g,
"'");c=new Function("c","var m = c.m;return "+l(a));this.cache["expr"+a]=c}if(c)try{return c(b)}catch(d){return console.error("Error while evaluating "+a),console.error(d),""}return a};e.prototype._getTemplate=function(a,b){if(Array.isArray(a))return a;/^'/.test(a)&&(a=a.slice(1,-1).replace(/\\'/g,"'"));return b.rc.options.partials[a]};e.prototype.ctlFn_foreach=function(a,b){var c=this._evalExpr(a.data,b);if(c&&Array.isArray(c))for(var d=this.compile(this._getTemplate(a.tpl),b),g=c.length,m=this.childContext(null,
b),h=0;h<g;h++)m.m=c[h],m.pms[0]=c[h],m.i=h,d(m)};e.prototype.ctlFn_template=function(a,b){var c=this._evalExpr(a.data,b),c=this.childContext(c,b),d=this._getTemplate(a.tpl,b);d&&this._render(d,c)};e.prototype.ctlFn_with=function(a,b){var c=this._evalExpr(a.data,b),d=this._getTemplate(a.tpl,b);c&&d&&(c=this.childContext(c,b),this._render(d,c))};e.prototype.ctlFn_if=function(a,b){this._evalExpr(a.data,b)&&this._render(a.tpl,b)};e.prototype.ctlFn_ifnot=function(a,b){this._evalExpr(a.data,b)||this._render(a.tpl,
b)};e.prototype.ctlFn_attr=function(a,b){var c=this,d;Object.keys(a).forEach(function(g){var m=a[g];"string"===typeof m?d=c._evalExpr(a[g],b):(d=m.v||"",m.app&&Array.isArray(m.app)&&m.app.forEach(function(a){a["if"]&&c._evalExpr(a["if"],b)&&(d+=a.v||"");a.ifnot&&!c._evalExpr(a.ifnot,b)&&(d+=a.v||"")}),!d&&null===m.v&&(d=null));d&&("href"===g||"src"===g?d=this.attrSanitizer.sanitizeHref(d):"style"===g&&(d=this.attrSanitizer.sanitizeStyle(d)));(d||0===d||""===d)&&b.cb(" "+g+'="'+d.toString().replace(/"/g,
"&quot;")+'"')})};e.prototype._xmlEncoder=function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case '"':return"&quot;";default:return"&#"+a.charCodeAt()+";"}};e.prototype.childContext=function(a,b){return{m:a,pc:b,pm:b.m,pms:[a].concat(b.ps),rm:b.rm,rc:b.rc,cb:b.cb}};e.prototype._assemble=function(a,b){function c(a){g.length&&(d.push("cb("+g.join("+")+");"),g=[]);d.push(a)}var d=[],g=[];d.push("var val;");for(var m=a.length,e=0;e<m;e++){var f=a[e],p=f.constructor;
if(p===String)g.push(JSON.stringify(f));else if(p===Array)if(p=f[0],f=f[1],"raw"===p)c(q(f,b,"val = ")+";\n"),g.push("val");else if("text"===p)c("val = "+q(f,b)+';\nval = val || val === 0 ? "" + val : "";\nif(/[<&]/.test(val)) { val = val.replace(/[<&]/g,this._xmlEncoder); }\n'),g.push("val");else if("attr"===p)for(var p=Object.keys(f),l=0;l<p.length;l++){var k=p[l];if("string"===typeof f[k])d.push("val = "+q(f[k],b)+";");else{var n=f[k];d.push("val="+JSON.stringify(n.v||""));n.app&&Array.isArray(n.app)&&
n.app.forEach(function(a){a["if"]?(d.push("if("+q(a["if"],b)+"){"),d.push("val += "+JSON.stringify(a.v||"")+";"),d.push("}")):a.ifnot&&(d.push("if(!"+q(a.ifnot,b)+"){"),d.push("val += "+JSON.stringify(a.v||"")),d.push("}"))});null===n.v&&d.push("if(!val) { val = null; }")}"href"===k||"src"===k?d.push("if (val) {val = this.attrSanitizer.sanitizeHref(val);}"):"style"===k&&d.push("if (val) {val = this.attrSanitizer.sanitizeStyle(val);}");c('if (val || val === 0 || val === \'\') { \nval = val || val === 0 ? "" + val : "";\nif(/[<&"]/.test(val)) { val = val.replace(/[<&"]/g,this._xmlEncoder); }\ncb('+
JSON.stringify(" "+k+'="')+" + val + '\"');}")}else l=this._getUID(),this.cache[l]=f,c("try {"),d.push("this["+JSON.stringify("ctlFn_"+p)+'](this.cache["'+l+'"], c);'),d.push("} catch(e) {"),d.push("console.error('Unsupported control function:', "+JSON.stringify(p)+", e.stack);"),d.push("}");else console.error("Unsupported type:",f)}c("");return d.join("\n")};e.prototype.render=function(a,b,c){c||(c={});b={rm:b,m:b,pms:[b],rc:null,g:c.globals,cb:c.cb,options:c};b.rc=b;var d="";c.cb||(b.cb=function(a){d+=
a});this._render(a,b);if(!c.cb)return d};e.prototype._render=function(a,b){if(a.__cachedFn)return a.__cachedFn(b);for(var c=a.length,d=b.cb,g=0;g<c;g++){var e=a[g],h=e.constructor;if(h===String)d(e);else if(h===Array){var h=e[0],f=e[1];if("raw"===h)d(this._evalExpr(f,b));else if("text"===h)e=this._evalExpr(f,b),!e&&0!==e&&(e=""),d((""+e).replace(/[<&]/g,this._xmlEncoder));else try{this["ctlFn_"+h](f,b)}catch(k){console.error("Unsupported control function:",e,k)}}else console.error("Unsupported type:",
e)}};e.prototype.compile=function(a,b){var c=this,d=b||{};if(a.__cachedFn)return a.__cachedFn;var e="";d.nestedTemplate?e+="var m = c.m, cb = c.cb;\n":(e=d.cb?e+"cb = options.cb;\n":e+'var res = "", cb = function(bit) { res += bit; };\n',e+="var m = c;\nc = { rc: null, rm: m, m: m, pms: [m], g: options.globals, options: options, cb: cb, nestedTemplate: true }; c.rc = c;\n");e+=this._assemble(a,d);d.cb||(e+="return res;");var k=new Function("c","options",e),e=function(a,b){return k.call(c,a,b||d)};
return a.__cachedFn=e};k.exports=new e},{"./AttributeSanitizer.js":1}]},{},[2])(2)});
