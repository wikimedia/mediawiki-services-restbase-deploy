'use strict';
module.exports = function generate_format(it) {
  var out = ' ';
  var $lvl = it.level,
    $dataLvl = it.dataLevel,
    $schema = it.schema['format'],
    $schemaPath = it.schemaPath + '.' + 'format',
    $errSchemaPath = it.errSchemaPath + '/' + 'format',
    $breakOnError = !it.opts.allErrors;
  var $data = 'data' + ($dataLvl || ''),
    $valid = 'valid' + $lvl,
    $errs = 'errs__' + $lvl;
  var $format = it.formats[$schema];
  var $isObject = typeof $format == 'object' && !($format instanceof RegExp) && $format.validate;
  if ($isObject) $format = $format.validate;
  if (it.opts.format !== false && $format) {
    out += ' if (!   ';
    if (typeof $format == 'function') {
      out += '  formats' + (it.util.getProperty($schema));
      if ($isObject) {
        out += '.validate';
      }
      out += '(' + ($data) + ') ';
    } else {
      out += '  formats' + (it.util.getProperty($schema));
      if ($isObject) {
        out += '.validate';
      }
      out += '.test(' + ($data) + ') ';
    }
    out += ') {  ';
    if (!it.compositeRule && $breakOnError) {
      out += ' validate.errors = [ '; /* istanbul ignore else */
      if (it.createErrors !== false) {
        out += ' { keyword: \'' + ('format') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: "' + ($errSchemaPath) + '" , params: { format: \'' + (it.util.escapeQuotes($schema)) + '\' } ';
        if (it.opts.messages !== false) {
          out += ' , message: \'should match format ' + (it.util.escapeQuotes($schema)) + '\' ';
        }
        if (it.opts.verbose) {
          out += ' , schema: ' + (it.util.toQuotedString($schema)) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
        }
        out += ' } ';
      } else {
        out += ' \'' + ('format') + '\' ';
      }
      out += ']; return false; ';
    } else {
      out += '  var err =   '; /* istanbul ignore else */
      if (it.createErrors !== false) {
        out += ' { keyword: \'' + ('format') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: "' + ($errSchemaPath) + '" , params: { format: \'' + (it.util.escapeQuotes($schema)) + '\' } ';
        if (it.opts.messages !== false) {
          out += ' , message: \'should match format ' + (it.util.escapeQuotes($schema)) + '\' ';
        }
        if (it.opts.verbose) {
          out += ' , schema: ' + (it.util.toQuotedString($schema)) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
        }
        out += ' } ';
      } else {
        out += ' \'' + ('format') + '\' ';
      }
      out += '; if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
    }
    out += ' } ';
    if ($breakOnError) {
      out += ' else { ';
    }
  } else {
    if ($breakOnError) {
      out += ' if (true) { ';
    }
  }
  return out;
}
